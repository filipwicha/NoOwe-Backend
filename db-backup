CREATE TABLE `users` (
  `id` int(8) NOT NULL AUTO_INCREMENT,
  `email` varchar(40) NOT NULL,
  `username` varchar(20) NOT NULL,
  `password` varchar(128) NOT NULL,
  `confirmed_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  `reset_send_at` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `budgets` (
  `id` int(8) NOT NULL AUTO_INCREMENT,
  `name` varchar(40) NOT NULL,
  `color` varchar(7) DEFAULT NULL,
  `owner_id` int(8) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `owner_id` (`owner_id`),
  CONSTRAINT `budgets_ibfk_1` FOREIGN KEY (`owner_id`) REFERENCES `users` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `transactions` (
  `id` int(8) NOT NULL AUTO_INCREMENT,
  `title` varchar(40) NOT NULL,
  `date` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  `budget_id` int(8) NOT NULL,
  `category_id` int(8) NOT NULL DEFAULT '1',
  PRIMARY KEY (`id`),
  KEY `budget_id` (`budget_id`),
  KEY `category_id_ibfk_2` (`category_id`),
  CONSTRAINT `category_id_ibfk_2` FOREIGN KEY (`category_id`) REFERENCES `categories` (`id`),
  CONSTRAINT `transactions_ibfk_1` FOREIGN KEY (`budget_id`) REFERENCES `budgets` (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=9 DEFAULT CHARSET=utf8;

CREATE TABLE `budget_members` (
  `id` int(8) NOT NULL AUTO_INCREMENT,
  `nickname` varchar(40) NOT NULL,
  `user_id` int(8) DEFAULT NULL,
  `budget_id` int(8) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `user_id` (`user_id`),
  KEY `budget_id` (`budget_id`),
  CONSTRAINT `budget_members_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`id`),
  CONSTRAINT `budget_members_ibfk_2` FOREIGN KEY (`budget_id`) REFERENCES `budgets` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `categories` (
  `id` int(8) NOT NULL AUTO_INCREMENT,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

CREATE TABLE `shares` (
  `id` int(8) NOT NULL AUTO_INCREMENT,
  `amount` decimal(12,2) NOT NULL,
  `transaction_id` int(8) NOT NULL,
  `member_id` int(8) NOT NULL,
  PRIMARY KEY (`id`),
  KEY `transaction_id` (`transaction_id`),
  KEY `member_id` (`member_id`),
  CONSTRAINT `shares_ibfk_1` FOREIGN KEY (`transaction_id`) REFERENCES `transactions` (`id`),
  CONSTRAINT `shares_ibfk_2` FOREIGN KEY (`member_id`) REFERENCES `budget_members` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;